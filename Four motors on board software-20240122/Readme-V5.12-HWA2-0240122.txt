MDA-48VBLDC-V3.0
-1.位置控制在30V条件下OK，电机运行方向为从ECU侧观察为CCW。
-2.采用时间步进控制启动，找到零位后切入位置换向控制。
-3.CAN通信收发OK
-4.ABI霍尔传感器，运行一圈计数1024脉冲。I(P33.5)相位置与B(P33.7)相位置硬件对调跳线
-5.PWM输出为方波，相线电压波形为梯形波。
-6.PWM采用ATOM三个通道进行单独配置，采用GTM/TOM六个通道配置冲突。
-7.ADC采样
-8.添加占空比旋钮控制，转速估算。

MDA-48VBLDC-V3.2-20230801
-1.CAN总线发送数据增加多帧发送序列。
-2.驱动占空比斜坡增加（1%/cycle）
-3.增加时间控制和位置控制的切换宏定义。
-4.NTC的ADC端口在调试中用于给定Duty输入的ADC。

MDA-48VBLDC-V3.3-20230804
-1.增加g_bldc结构体变量对电机的状态，速度等信息进行集中管理。
-2.定义电机的几个状态：停止（Stop）、启动（Startup）、运行（Running）、故障（Fail）
-3.优化速度计算模块。
-4.增加速度检测模块，增加低速堵转保护，高速失速保护。
-5.初始定义了如下几个故障码：
-启动失败
-堵转
-失速
-6.CAN总线中增加速度、故障码，电机状态和旋转方向的信息输出（Msg_0x776）

MDA-48VBLDC-NewBoard-V4.0-20230809
-1.通过不断扫描进行母线电压、相电流采样，限制母线电压和相电流的范围来进行电机保护。
-2.新增故障码：相电流过大、母线电压过大。
-3.CAN总线上增加相电流信息、母线电压信息输出（Msg_0x778）
-4.修改PWM输出引脚。

MDA-48VBLDC-NewBoard-V4.2-HWA1-202308013
-1.修改一圈脉冲计数最小值为5，并在检测到零位后再进行位置保护检测
-2.修改实时脉冲计数保护，添加了脉冲数保持不变时的堵转保护，并改为1ms任务

MDA-48VBLDC-NewBoard-V4.3-HWA1-202308014
-1.增加相电流滤波，滤波系数α=0.1

MDA-48VBLDC-NewBoard-V4.4-HWA1-202308016
-1.使用If_NOP(1)循环40次延时1ms惊进行零位信号的检测。
-2.根据测试情况将零位偏移量K_ELE_ZERO_OFFSET设置为22。
-3.换向点POINT_01对应的脉冲数+1。

MDA-48VBLDC-NewBoard-V4.5-HWA1-202308018
-1.使用If_NOP(1)循环80次延时2ms惊进行零位信号的检测。
-2.补充电机反转部分。
-3.ADC采用中，使用50us的定时中断进行采样。但是从CAN收集的数据来看，采样的频率和设想的不一样，100ms才采到一个数。

MDA-48VBLDC-NewBoard-V4.6-HWA1-202308018
-1.反转调试，改变step偏移量进行测试，一直存在堵转问题。
-2.添加换向位置的换向点检测，经检测，换向点和设置相符。

MDA-48VBLDC-NewBoard-V4.7-HWA1-202308019
-1.反转调试，改变换相表桥臂打开顺序，解决反转（CW）启动不了的问题。step偏移设置为2，换相点偏移设置为11。

MDA-48VBLDC-NewBoard-V4.8-HWA1-202308023
-1.  SPI读取转子初始位置Encoder_StartPosition，取消零位检测，通过初始位置快速启动。

MDA-48VBLDC-NewBoard-V4.9-HWA1-202308028
-1.快速启动设置，占空比变化调至1ms增加1，初始占空比调至10。

MDA-48VBLDC-NewBoard-V4.12-HWA1-20230907
-1.相电流采样，电流一阶低通滤波，加上电流保护，启动后1.2s开启电流保护。
-2.增加速度PID控制

MDA-48VBLDC-NewBoard-V4.13-HWA1-20230909
-1.速度PID调试，在空载时系数KP=0.3-1；KI=0.018时在速度范围800-2700时速度波动很小，±20左右，其中在速度1300、1400、1500、2500、2600时可以达到平衡。
问题：以上为空载测试结果，但是加上负载后波动很大，无法达到平衡。（单环控制的局限性）
解决办法：目前暂时调整KP=30，KI=0.018，在全速度范围内加负载（2NM）的情况下，转速变化在±50。
后续需要加上电流环，双环控制。

MDA-48VBLDC-NewBoard-V4.13-HWA1-20230913
-1.添加上位机参考速度输入。
-2.在低通滤波后加上加上电流均值滤波，测试效果一般。

MDA-48VBLDC-NewBoard-V4.15-HWA1-20230915
-1.添加驱动板温度检测。
-2.增加斜率滤波，效果没有一阶低通效果好。

MDA-48VBLDC-NewBoard-V4.16-HWA1-20230917
-1.更改ADC模块初始化方式，可通过SingleADC_Init(uint8 group_i,uint8 chnIx)初始化单通道为scan模式。相电流电流采样通过BackgroundADC模块单独配置。
-2.更改速度PID的输出值为占空比的变化值。
-3.添加启动过程占空比上升曲线和限制曲线。
-3.设置速度达到(REF_Speed-50)时进入running模式。

MDA-48VBLDC-NewBoard-V4.17-HWA1-20230921
-1.相电流过采样，配置结果寄存器中累积四个结果值，每次换相点过后30%处取出此时的采样值，取均值作为此时的电流值，最后电流值经过一阶低通滤波取出使用。
-2.添加上位机初始化控制命令，在发生故障后无法顺利启动时可以重新初始化。
-3.添加电机stop状态下的电流检测，检测后取平均值，作为电流的偏移量。

MDA-48VBLDC-NewBoard-V5.0-HWA2-20230928
-1.更改占空比限制曲线和占空比增加曲线实现快速启动，在1000r/min转速120bar压强下启动时间90ms左右，母线电流40A左右。
-2.将相电流AD值转化为实际电流值并由上位机显示，放大倍数31，采样电阻2.5mΩ。添加过流保护功能。

MDA-48VBLDC-NewBoard-V5.1-HWA2-20231013
-1.电流环添加，通过设定电流值可以使得电机输出相应的扭矩值
-2.添加母线电压检测，实现电机的过压欠压保护

MDA-48VBLDC-NewBoard-V5.2-HWA2-20231023
-1.添加位置环控制，目前误差在±10个脉冲左右。

MDA-48VBLDC-NewBoard-V5.3-HWA2-20231026
-1.添加电机模式（g_bldc.loop_mode）切换命令g_bldc.loop_cmd，
1：速度环；
2：电流环（扭矩环）；
3：位置环；
只有电机停止时才能够进行模式切换。
-2.反馈转子角度位置（0-360°），位置控制输入。
-3.添加转子位置保持函数HoldingPosition();上桥占空比设置为0，关闭PWM，打开下桥。
-4.添加新的电机状态g_bldc.state——转子位置保持状态4，进入该状态时转子位置保持不变，避免了running时的堵转检测等。
-5.母线电压故障check和电流故障check分开检测，电压故障check放在200ms任务，电流故障check放在1ms任务，消除上电时，电压故障检测快于实际电压检测而显示欠压的bug。
-6.CANFD频率修改为数据域2M波特率，仲裁域500K，实现与Protronic的通信控制与反馈。
-7.添加2ms任务，CAN消息发送改为2ms任务，CANFD通信时若1ms发送数据量过大。
-8.解决软件速度计算与测量仪测量值误差较大的bug。
-9.采样电流放大倍数由31修正为30。


MDA-48VBLDC-NewBoard-V5.4-HWA2-20231106
-1、添加电机位置参数的dataflash的写入存储，上电启动时读取参数。

MDA-48VBLDC-NewBoard-V5.5-HWA2-20231106
-1、配置两路CAN节点，实现两路CAN通信。
-2、在普通CAN的接收节点上使用掩码模式接收多个ID的报文，用于支持后续通过上位机进行更多的标定量修改。

MDA-48VBLDC-NewBoard-V5.6-HWA2-20231111
-1.相电流参数类型由uint16改为float32,便于电流环的调试。电流error大于0.6A时进行PID调节。

MDA-48VBLDC-NewBoard-V5.7-HWA2-20231116
-1.故障码的清除添加到软复位指令中；
-2.添加速度环PID和电流环PID的参数标定，电机类型序号（左后、左前、右后、右前）的修改；
-3.解决断电重新上电后can模块失去通信的问题。

MDA-48VBLDC-NewBoard-V5.8-HWA2-20231120
-1.针对电机给4000r十秒后停机的问题，修改了电机启动是否成功的判断方式。


MDA-48VBLDC-NewBoard-V5.9-HWA2-20231123
-1.速度的反馈和控制量都改为1rpm的精度。
-2.添加电机未启动状态下的速度测量和方向判断，消除电机停机时的速度异常脉冲。
-3.设置目标速度280rpm以下时电机不启动。

MDA-48VBLDC-NewBoard-V5.10-HWA2-20231124
-1.占空比精度改为1/10000;

MDA-48VBLDC-NewBoard-V5.11-HWA2-20231125
-1.配置了V相PWM的中断，脉冲触发；
-2.添加了一个50us的定时器中断；
-3.现场调试电流环：电流PID放在1ms任务增加计算频率→电流PID计算放在电流采样中断中；但是500r低速下
扭矩波动都较大（2NM）

MDA-48VBLDC-NewBoard-V5.12-HWA2-20231127
-1.调试：
（1）电流环计算放在50us定时器中，结果显示占空比波动更大，分析为计算速度比电流更新快的问题。
（2）修改电流环PI参数，扭矩波动无改善。

MDA-48VBLDC-Four motors on board software-20240122
-1.根据客户要求优化故障代码后的四台上车电机代码。









